# 异常图像分类工具

![Python](https://img.shields.io/badge/Python-3.7%2B-blue.svg)
![FastAPI](https://img.shields.io/badge/FastAPI-0.68.0%2B-green.svg)
![OpenCV](https://img.shields.io/badge/OpenCV-4.5%2B-orange.svg)

这是一个用于异常检测模型测试集图像分类的工具，帮助用户手动分类误报和正报图像，并提供图像旋转、灰度转换、亮度对比度调整等功能。该工具特别适用于计算机视觉模型评估阶段，能够快速标记大量测试图像的结果。

## 功能特点

- **目录监控**：自动监控指定目录下的图像文件变化，实时更新界面
- **图像分类**：支持将图像标记为误报(wubao)、正报(zhengbao)或未分类
- **图像操作**：支持旋转、灰度转换、亮度和对比度调整，方便查看图像细节
- **键盘快捷键**：方向键控制上一张/下一张，D键标记为误报，F键标记为正报，C键清除分类
- **排序和过滤**：支持按文件名中的数字从小到大/从大到小排序，支持按分类状态过滤
- **实时更新**：使用WebSocket实现前端实时更新，保证多用户操作的一致性

## 技术栈

- **后端**：Python + FastAPI
- **前端**：HTML + CSS + JavaScript
- **图像处理**：OpenCV
- **文件监控**：Watchdog
- **WebSocket**：FastAPI WebSocket支持

## 安装和运行

### 前置条件

- Python 3.7或更高版本
- pip包管理工具

### 步骤

1. **克隆项目**（如果是从GitHub克隆）

```bash
git clone https://github.com/your-username/abnormal-image-classifier.git
cd abnormal-image-classifier
```

2. **安装依赖**

```bash
pip install -r requirements.txt
```

3. **运行应用**

```bash
./run.sh
```

或者直接运行：

```bash
uvicorn main:app --reload --host 127.0.0.1 --port 8000
```

4. 打开浏览器，访问 `http://127.0.0.1:8000`

## 使用说明

### 基本操作

1. 在顶部地址栏输入包含待分类图像的文件夹路径，按Enter确认
2. 系统会自动加载该目录下的所有图像文件
3. 在左侧列表中可以查看图像名称和分类状态
4. 点击列表中的图像可以在右侧查看大图

### 分类操作

- **标记为误报**：点击图像后按D键，或在图像上右键选择"标记为误报"
- **标记为正报**：点击图像后按F键，或在图像上右键选择"标记为正报"
- **清除分类**：点击图像后按C键，或在图像上右键选择"清除分类"
- **清除所有分类**：点击左侧面板中的"清除所有分类"按钮（注意：此操作不可恢复）

### 图像操作

- **旋转**：拖动"旋转"滑块调整图像角度
- **亮度**：拖动"亮度"滑块调整图像亮度
- **对比度**：拖动"对比度"滑块调整图像对比度
- **灰度**：勾选"灰度图"复选框将图像转换为灰度显示
- **重置**：点击"重置"按钮恢复图像原始状态

### 排序和过滤

- **排序**：点击左侧面板中的"从小到大排序"或"从大到小排序"按钮
- **过滤**：通过左侧面板中的复选框选择要显示的分类状态

## 项目结构

```
├── main.py              # 主程序入口，包含所有API端点和WebSocket处理
├── requirements.txt     # 项目依赖
├── run.sh               # 运行脚本
├── static/              # 静态资源文件夹
└── templates/           # 模板文件夹
    └── index.html       # 主页面HTML文件
```

## 常见问题

### 图像无法加载
- 确认输入的文件夹路径正确
- 确认文件夹中包含支持的图像格式（jpg、jpeg、png、bmp、gif、tiff）
- 确认图像文件没有被其他程序锁定

### 操作不响应
- 刷新页面后重新尝试
- 确认网络连接正常
- 检查浏览器控制台是否有错误信息

## 贡献指南

欢迎提交问题和改进建议！如果您想贡献代码，请：
1. Fork项目仓库
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建Pull Request

## 许可证

本项目采用MIT许可证 - 详见LICENSE文件

## 联系方式

如有问题或建议，请联系：
- 作者：[您的姓名]
- 邮箱：[您的邮箱地址]
- GitHub：[https://github.com/your-username]
5. 使用右侧的控制条可以调整图像的旋转角度、亮度、对比度，或转换为灰度图
6. 使用键盘快捷键或点击图像进行分类
7. 分类后的图像会被复制到与原文件夹同级的`wubao`或`zhengbao`文件夹中

## 注意事项

- 图像文件命名格式应为：字符串+数字+其他字符串（例如：image_123.jpg）
- 分类操作会在原始图像文件夹的同级目录创建`wubao`和`zhengbao`文件夹
- 清除分类操作会从分类文件夹中删除对应的图像文件
- 图像操作仅在当前会话中有效，不会修改原始图像文件

## 快捷键说明

- `↑`: 上一张图像
- `↓`: 下一张图像
- `D`: 标记为误报
- `F`: 标记为正报
- `C`: 清除当前图像分类